<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Building Packages · BinaryBuilder.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>BinaryBuilder.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Home</a></li><li class="current"><a class="toctext" href>Building Packages</a><ul class="internal"><li><a class="toctext" href="#Initiating-different-shell-commands-based-on-target-1">Initiating different shell commands based on target</a></li><li><a class="toctext" href="#Autoconfigure-builds-1">Autoconfigure builds</a></li><li><a class="toctext" href="#CMake-builds-1">CMake builds</a></li><li><a class="toctext" href="#Meson-builds-1">Meson builds</a></li><li><a class="toctext" href="#Builds-with-binary-dependencies-1">Builds with binary dependencies</a></li><li><a class="toctext" href="#Editing-files-in-the-wizard-1">Editing files in the wizard</a></li><li><a class="toctext" href="#Automatic-environment-variables-1">Automatic environment variables</a></li><li><a class="toctext" href="#Using-GCC-on-macOS-and-FreeBSD-1">Using GCC on macOS and FreeBSD</a></li></ul></li><li><a class="toctext" href="../FAQ/">FAQ</a></li><li><span class="toctext">Internals</span><ul><li><a class="toctext" href="../rootfs/">RootFS</a></li><li><a class="toctext" href="../environment_variables/">Environment Variables</a></li><li><a class="toctext" href="../tricksy_gotchas/">Tricksy Gotchas</a></li><li><a class="toctext" href="../reference/">Reference</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Building Packages</a></li></ul><a class="edit-page" href="https://github.com/JuliaPackaging/BinaryBuilder.jl/blob/master/docs/src/build_tips.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Building Packages</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Tips-for-Building-Packages-1" href="#Tips-for-Building-Packages-1">Tips for Building Packages</a></h1><p>BinaryBuilder provides a convenient environment to enable cross-platform building. But, many libraries have complicated build scripts that may need to be adapted to support all of the BinaryBuilder targets.</p><p><em>If you have additional tips, please submit a PR with suggestions.</em></p><h2><a class="nav-anchor" id="Initiating-different-shell-commands-based-on-target-1" href="#Initiating-different-shell-commands-based-on-target-1">Initiating different shell commands based on target</a></h2><p>Sometimes, you need to adapt build scripts based on the target platform. This can be done within the shell script. Here is an example from <a href="https://github.com/staticfloat/OpenBLASBuilder/blob/master/build_tarballs.jl">staticfloat/OpenBLASBuilder</a>:</p><pre><code class="language-sh"># Set BINARY=32 on i686 platforms and armv7l
if [[ ${nbits} == 32 ]]; then
    flags=&quot;${flags} BINARY=32&quot;
fi</code></pre><p>Here are other examples of scripts with target-specific checks:</p><ul><li><a href="https://github.com/JuliaPackaging/Yggdrasil/blob/8b9ba2b7b4652e96daf506c98c2b373b48eef5cb/X/XZ/build_tarballs.jl">XZ</a> - Custom windows installation</li><li><a href="https://github.com/JuliaPackaging/Yggdrasil/blob/fdbb7392c498cbf5b440cc947c29ab6790de18c6/S/Sundials/build_tarballs.jl#L52-L60">Sundials</a> - 32-bit check</li></ul><p>It is also possible to run quite different scripts for each target by running different build scripts for different sets of targets. Here is an example where windows builds are separated from other targets:</p><ul><li><a href="https://github.com/JuliaPackaging/Yggdrasil/blob/bf4ac37978764a3e953d06d7ed052ef06968f3bf/G/Git/build_tarballs.jl">Git</a></li></ul><h2><a class="nav-anchor" id="Autoconfigure-builds-1" href="#Autoconfigure-builds-1">Autoconfigure builds</a></h2><p>Autoconfigure builds are generally quite straightforward. Here is a typical approach:</p><pre><code class="language-sh">./configure --prefix=$prefix --host=${target}
make -j${nproc}
make install</code></pre><p>Here are examples of autoconfigure build scripts:</p><ul><li><a href="https://github.com/JuliaPackaging/Yggdrasil/blob/4cacbf2377730f60255500b4e7dd58d9f9c18752/P/Patchelf/build_tarballs.jl#L18-L20">Patchelf</a></li><li><a href="https://github.com/JuliaPackaging/Yggdrasil/blob/4dd53a5ea3df104aa9f3f8f4cd9996568871d2af/L/LibCURL/build_tarballs.jl#L37-L39">LibCURL</a></li></ul><h2><a class="nav-anchor" id="CMake-builds-1" href="#CMake-builds-1">CMake builds</a></h2><p>For CMake, the wizard will suggest a template for running CMake. Typically, this will look like:</p><pre><code class="language-sh">cmake -DCMAKE_INSTALL_PREFIX=${prefix} -DCMAKE_TOOLCHAIN_FILE=${CMAKE_TARGET_TOOLCHAIN}</code></pre><p>The toolchain file sets up several CMake environment variables for better cross-platform support, such as <code>CMAKE_SYSROOT</code>, <code>CMAKE_C_COMPILER</code>, etc...  Examples of builds that include CMake parts include:</p><ul><li><p><a href="https://github.com/JuliaPackaging/Yggdrasil/blob/92fb385b4de0bdd0c378b45e83ef4bad116bbd08/J/JpegTurbo/build_tarballs.jl">JpegTurbo</a></p></li><li><p><a href="https://github.com/JuliaPackaging/Yggdrasil/blob/fdbb7392c498cbf5b440cc947c29ab6790de18c6/S/Sundials/build_tarballs.jl#L46-L60">Sundials</a></p><ul><li>Needs <code>-DSUNDIALS_INDEX_TYPE=int32_t</code> on 32-bit targets (Sundials-specific way to specify integer size)</li><li>Needs to copy *.dll files from <code>destdir/lib</code> to <code>destdir/bin</code> for windows; this also removes symlinks by using <code>cp -L</code></li><li>Needs <code>-DCMAKE_FIND_ROOT_PATH=&quot;$WORKSPACE/destdir&quot;</code>, so CMake&#39;s <code>find_library</code> can find libraries from KLU</li></ul></li></ul><h2><a class="nav-anchor" id="Meson-builds-1" href="#Meson-builds-1">Meson builds</a></h2><p>BinaryBuilder supports also building with Meson.  Since this is going to be a cross-compilation, you have to specify a Meson cross file:</p><pre><code class="language-sh">meson --cross-file=&quot;${MESON_TARGET_TOOLCHAIN}&quot;</code></pre><p>After configuring the project with <code>meson</code>, you can then build and install it with</p><pre><code class="language-none">ninja -j${nproc}
ninja install</code></pre><p>The wizard automatically suggests using Meson if the <code>meson.build</code> file is present.</p><p>Examples of builds performed with Meson include:</p><ul><li><p><a href="https://github.com/JuliaPackaging/Yggdrasil/blob/2f3638292c99fa6032634517f8a1aa8360d6fe8d/G/gdk_pixbuf/build_tarballs.jl">gdk-pixbuf</a></p><ul><li>Here meson uses platform-dependent options</li></ul></li><li><p><a href="https://github.com/JuliaPackaging/Yggdrasil/blob/2f3638292c99fa6032634517f8a1aa8360d6fe8d/L/Libepoxy/build_tarballs.jl">libepoxy</a></p><ul><li>This script modifies <code>c_args</code> in the Meson cross file in order to add an include directory</li></ul></li><li><p><a href="https://github.com/JuliaPackaging/Yggdrasil/blob/2f3638292c99fa6032634517f8a1aa8360d6fe8d/X/xkbcommon/build_tarballs.jl">xkbcommon</a></p></li></ul><h2><a class="nav-anchor" id="Builds-with-binary-dependencies-1" href="#Builds-with-binary-dependencies-1">Builds with binary dependencies</a></h2><p>A build script can depend on binaries generated by another Builder repository. A builder specifies <code>dependencies</code> in the form of previously-built JLL packages:</p><pre><code class="language-julia">dependencies = [
    # We need libogg to build FLAC
    &quot;Ogg_jll&quot;,
]</code></pre><p>In the wizard, this can be specified with the prompt: <em>Do you require any (binary) dependencies?  [y/N]</em>.</p><p>Examples of builders that depend on other binaries include:</p><ul><li><a href="https://github.com/JuliaPackaging/Yggdrasil/blob/029e588412f232f215e5e6a7564693d3dbf8e922/I/ImageMagick/build_tarballs.jl#L32-L35">ImageMagick</a> depends on <code>Zlib</code>, <code>libpng</code>, <code>JpegTurbo</code> and <code>Libtiff</code>.</li></ul><h2><a class="nav-anchor" id="Editing-files-in-the-wizard-1" href="#Editing-files-in-the-wizard-1">Editing files in the wizard</a></h2><p>In the wizard, the <code>vim</code> editor is available for editing files. But, it doesn&#39;t leave any record in the build script. One generally needs to provide patch files or use something like <code>sed</code>. If a file needs patching, we suggest using <code>git</code> to add the entire worktree to a new repo, make the changes you need, then use <code>git diff -p</code> to output a patch that can be included alongside your build recipe.</p><p>You can include local files like patches very easily by placing them within a <code>bundled/patches</code> nested directory, and then providing <code>&quot;./bundled&quot;</code> as one of the <code>sources</code> for your build.  See, for example, <a href="https://github.com/JuliaPackaging/Yggdrasil/tree/029e588412f232f215e5e6a7564693d3dbf8e922/O/OpenBLAS"><code>OpenBLAS</code></a>.</p><h2><a class="nav-anchor" id="Automatic-environment-variables-1" href="#Automatic-environment-variables-1">Automatic environment variables</a></h2><p>The following environment variables are automatically set in the build environment and should be used to build the project.  Occasionally, you may need to tweak them (e.g., if you need to use GCC on macOS or FreeBSD, see the below.</p><ul><li><code>CC</code>: the C cross compiler</li><li><code>CXX</code>: the C++ cross compiler</li><li><code>FC</code>: the Fortran cross compiler</li><li><code>OBJC</code>: the Objective-C cross compiler</li><li><code>AR</code>: the archiver</li><li><code>AS</code>: the assembler</li><li><code>LD</code>: the linker</li><li><code>NM</code>: the utility to list symbols from object files</li><li><code>OBJDUMP</code>: the utility to display information from object files</li><li><code>RANLIB</code>: the utility to generate index to archives</li><li><code>CFLAGS</code>: options for the C compiler</li><li><code>CXXFLAGS</code>: options for the C++ compiler</li><li><code>LDFLAGS</code>: options for the linker</li><li><code>PKG_CONFIG_PATH</code>: a colon-separated list of directories to search for <code>.pc</code> files</li><li><code>PKG_CONFIG_SYSROOT_DIR</code>: modifies <code>-I</code> and <code>-L</code> to use the directories located in target sysroot</li></ul><p>The following variables are useful to control the build script over different target systems, but are not intended to be modified by the users:</p><ul><li><code>target</code>: the target platform</li><li><code>nproc</code>: the number of processors of the host machine, useful for parallel building (e.g., <code>make -j${nproc}</code>)</li><li><code>nbits</code>: number of bits of the target architecture (usually it is either 32 or 64)</li><li><code>proc_family</code>: target processor family (e.g., &quot;intel&quot;, &quot;power&quot;, or &quot;arm&quot;)</li><li><code>dlext</code>: extension of the shared library on the target system.  It is &quot;dll&quot; for Windows, &quot;dylib&quot; for macOS, and &quot;so&quot; for the other Unix systems.</li></ul><h2><a class="nav-anchor" id="Using-GCC-on-macOS-and-FreeBSD-1" href="#Using-GCC-on-macOS-and-FreeBSD-1">Using GCC on macOS and FreeBSD</a></h2><p>For these target systems Clang is the default compiler, however some programs may not be compatible with Clang.</p><p>For programs built with CMake (see the <a href="#CMake-builds-1">CMake build</a> section) you can use the GCC toolchain file that is in <code>${CMAKE_TARGET_TOOLCHAIN%.*}_gcc.cmake</code>.</p><p>If the project that you want to build uses the GNU Build System (also knows as the Autotools), there isn&#39;t an automatic switch to use GCC, but you have to set the appropriate variables.  For example, this setting can be used to build most C/C++ programs with GCC for FreeBSD and macOS:</p><pre><code class="language-sh">if [[ &quot;${target}&quot; == *-freebsd* ]] || [[ &quot;${target}&quot; == *-apple-* ]]; then
    CC=gcc
    CXX=g++
fi</code></pre><footer><hr/><a class="previous" href="../"><span class="direction">Previous</span><span class="title">Home</span></a><a class="next" href="../FAQ/"><span class="direction">Next</span><span class="title">FAQ</span></a></footer></article></body></html>
